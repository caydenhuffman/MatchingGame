musical = [
    { time: "0:0:2", note: 'E4', duration: '16n' },
    { time: "0:0:3", note: 'E4', duration: '16n' },
    { time: "0:1", note: 'E4', duration: '16n' },
    { time: "0:1:1", note: 'E4', duration: '16n' },
    { time: "0:1:2", note: 'E4', duration: '16n' },
    { time: "0:1:3", note: 'E4', duration: '16n' },
    { time: "0:3:1", note: 'E4', duration: '16n' },
    { time: "0:3:2", note: 'E4', duration: '16n' },
    { time: "0:3:3", note: 'E4', duration: '16n' },
    { time: "1:0", note: 'E4', duration: '16n' },
    { time: "1:0:1", note: 'E4', duration: '16n' },
    { time: "1:0:2", note: 'E4', duration: '16n' },
    { time: "1:0:3", note: 'E4', duration: '16n' },
    { time: "1:1", note: 'E4', duration: '16n' },
    { time: "1:1:1", note: 'E4', duration: '16n' },
    { time: "1:1:2", note: 'E4', duration: '16n' },
    { time: "1:1:3", note: 'E4', duration: '16n' },
    { time: "1:2", note: 'E4', duration: '16n' },
    { time: "1:2:1", note: 'E4', duration: '16n' },
    { time: "1:2:2", note: 'E4', duration: '16n' },
    { time: "1:2:3", note: 'E4', duration: '16n' },
    { time: "1:3", note: 'F#4', duration: '8n' },
    { time: "1:3:2", note: 'E4', duration: '16n' },
    { time: "1:3:3", note: 'D4', duration: '16n' },//Ties
    { time: "2:0", note: 'D4', duration: '4n' },
    { time: "4:0:2", note: 'E4', duration: '16n' },
    { time: "4:0:3", note: 'E4', duration: '16n' },
    { time: "4:1", note: 'E4', duration: '16n' },
    { time: "4:1:1", note: 'E4', duration: '16n' },
    { time: "4:1:2", note: 'E4', duration: '16n' },
    { time: "4:1:3", note: 'E4', duration: '16n' },
    { time: "4:3:2", note: 'E4', duration: '16n' },
    { time: "4:3:3", note: 'E4', duration: '16n' },
    { time: "5:0", note: 'E4', duration: '16n' },
    { time: "5:0:1", note: 'E4', duration: '16n' },
    { time: "5:0:2", note: 'E4', duration: '16n' },
    { time: "5:0:3", note: 'E4', duration: '16n' },
    { time: "5:1", note: 'E4', duration: '16n' },
    { time: "5:1:1", note: 'E4', duration: '16n' },
    { time: "5:1:2", note: 'E4', duration: '16n' },
    { time: "5:1:3", note: 'E4', duration: '16n' },
    { time: "5:2", note: 'E4', duration: '16n' },
    { time: "5:2:1", note: 'E4', duration: '16n' },
    { time: "5:2:2", note: 'E4', duration: '16n' },
    { time: "5:2:3", note: 'E4', duration: '16n' },
    { time: "5:3", note: 'F#4', duration: '8n' },
    { time: "5:3:2", note: 'E4', duration: '16n' },
    { time: "5:3:3", note: 'D4', duration: '16n' },//Ties
    { time: "6:0", note: 'D4', duration: '4n' },
    { time: "7:2:3", note: 'A3', duration: '16n' },
    { time: "7:3:0", note: 'A3', duration: '16n' },
    { time: "7:3:1", note: 'A3', duration: '8n' },
    { time: "7:3:3", note: ['A4', 'F#4', 'D4', 'B3'], duration: '16n' },

    { time: "8:0", note: ['A4', 'F#4', 'D4', 'B3'], duration: '16n' },
    { time: "8:0:1", note: 'B3', duration: '16n' },
    { time: "8:0:2", note: 'B3', duration: '16n' },
    { time: "8:0:3", note: 'B3', duration: '16n' },
    { time: "8:1:0", note: 'B3', duration: '16n' },
    { time: "8:1:1", note: 'B3', duration: '8n' },
    { time: "8:1:3", note: ['B3', 'G3'], duration: '16n' },
    { time: "8:2", note: ['B3', 'G3'], duration: '16n' },

    { time: "9:0", note: ['B3', 'G3'], duration: '16n' },
    { time: "9:0:1", note: 'B3', duration: '16n' },
    { time: "9:0:2", note: 'B3', duration: '16n' },
    { time: "9:0:3", note: 'B3', duration: '16n' },
    { time: "9:1", note: ['B3', 'G3'], duration: '16n' },
    { time: "9:1:1", note: 'B3', duration: '16n' },
    { time: "9:1:2", note: 'B3', duration: '16n' },
    { time: "9:1:3", note: 'B3', duration: '16n' },
    { time: "9:2", note: ['B3', 'G3'], duration: '16n' },
    { time: "9:2:1", note: 'B3', duration: '16n' },
    { time: "9:2:2", note: 'B3', duration: '16n' },
    { time: "9:2:3", note: 'B3', duration: '16n' },

    { time: "9:3", note: 'G3', duration: '8n' },
    { time: "9:3:3", note: ['F#4', 'A4', 'C#4'], duration: '16n' },

    { time: "10:0", note: ['F#4', 'A4', 'C#4'], duration: '16n' },
    { time: "10:0:1", note: 'C#4', duration: '16n' },
    { time: "10:0:2", note: 'C#4', duration: '8n' },
    { time: "10:1:0", note: 'C#4', duration: '16n' },
    { time: "10:1:1", note: ['C#4', 'A3'], duration: '8n' },
    { time: "10:3:1", note: "E4", duration: '16n' },
    { time: "10:3:2", note: "F#4", duration: '8n' },

    { time: "11:0", note: ['A3', 'E4'], duration: '16n' },
    { time: "11:0:1", note: 'D4', duration: '16n' },
    { time: "11:0:2", note: 'D4', duration: '16n' },
    { time: "11:0:3", note: 'D4', duration: '16n' },
    { time: "11:1", note: ['A3', 'D4'], duration: '4n' },
    { time: "11:3:0", note: 'A3', duration: '16n' },
    { time: "11:3:1", note: 'A3', duration: '8n' },
    { time: "11:3:3", note: ['A4', 'F#4', 'D4', 'B3'], duration: '16n' },

    { time: "12:0", note: ['A4', 'F#4', 'D4', 'B3'], duration: '16n' },
    { time: "12:0:1", note: 'B3', duration: '16n' },
    { time: "12:0:2", note: 'B3', duration: '16n' },
    { time: "12:0:3", note: 'B3', duration: '16n' },
    { time: "12:1:0", note: 'B3', duration: '16n' },
    { time: "12:1:1", note: 'B3', duration: '8n' },
    { time: "12:1:3", note: 'B3', duration: '16n' },
    { time: "12:3:1", note: 'G3', duration: '16n' },
    { time: "12:3:2", note: 'G3', duration: '16n' },
    { time: "12:3:3", note: 'G3', duration: '16n' },

    { time: "13:0", note: 'B3', duration: '16n' },
    { time: "13:0:1", note: ['B3', 'G3'], duration: '8n' },
    { time: "13:0:3", note: ['B3', 'G3'], duration: '16n' },
    { time: "13:1", note: ['B3', 'G3'], duration: '16n' },
    { time: "13:1:1", note: 'A3', duration: '16n' },
    { time: "13:1:2", note: 'B3', duration: '16n' },
    { time: "13:1:3", note: 'B3', duration: '16n' },
    { time: "13:2", note: ['B3', 'G3'], duration: '16n' },
    { time: "13:2:1", note: 'B3', duration: '8n' },
    { time: "13:2:3", note: 'A3', duration: '16n' },
    { time: "13:3", note: 'B3', duration: '8n' },
    { time: "13:3:2", note: 'B3', duration: '8n' },

    { time: "14:0", note: ['F#4', 'A4', "C#4"], duration: '4n' },
    { time: "14:1", note: 'E4', duration: '16n' },
    { time: "14:1:1", note: 'D4', duration: '16n' },
    { time: "14:1:2", note: 'B3', duration: '8n' },
    { time: "14:3", note: 'F#4', duration: '4n' },

    { time: "15:0", note: 'E4', duration: '16n' },
    { time: "15:0:1", note: 'D4', duration: '16n' },
    { time: "15:0:2", note: 'B3', duration: '8n' },
    { time: "15:3:1", note: 'B3', duration: '16n' },
    { time: "15:3:2", note: 'F#4', duration: '8n' },

    { time: "16:0", note: ['E4', 'B3'], duration: '4n' },
    { time: '16:1', note: ['D4', 'B3'], duration: '4n' },
    { time: "16:2", note: 'B3', duration: '8n' },
    { time: "16:2:2", note: 'B3', duration: '8n' },
    { time: "16:3", note: ['F#4', 'D4', 'B3'], duration: '8n' },
    { time: "16:3:2", note: 'F#4', duration: '8n' },

    { time: "17:0", note: ['E4', 'B3'], duration: '4n' },
    { time: '17:1', note: ['D4', 'B3'], duration: '4n' },
    { time: "17:2", note: 'B3', duration: '8n' },
    { time: "17:2:2", note: 'B3', duration: '8n' },
    { time: "17:3", note: ['F#4', 'D4', 'B3'], duration: '8n' },
    { time: "17:3:2", note: 'F#4', duration: '8n' },

    { time: "18:0", note: ['E4', 'A3', 'F#3'], duration: '4n' },
    { time: "18:1", note: ['D4', 'A3', 'F#3'], duration: '4n' },
    { time: "18:2", note: ['A3', 'F#3'], duration: '8n' },
    { time: "18:2:2", note: 'A3', duration: '8n' },
    { time: "18:3", note: ['A3', 'F#4', 'D4'], duration: '8n' },
    { time: "18:3:2", note: 'F#4', duration: '8n' },

    { time: "19:0", note: ['E3', 'C#4', 'A3'], duration: '4n' },
    { time: "19:1", note: ['D4', 'A3'], duration: '4n' },
    { time: "19:2:1", note: 'D4', duration: '16n' },
    { time: "19:2:2", note: 'F#4', duration: '8n' },
    { time: "19:3:0", note: ['A4', "E4", "C#4"], duration: '16n' },
    { time: "19:3:1", note: 'F#4', duration: '16n' },
    { time: "19:3:2", note: 'F#4', duration: '8n' },

    { time: "20:0", note: ['E4', 'B3'], duration: '4n' },
    { time: "20:1", note: ['D4', 'B3'], duration: '4n' },
    { time: "20:2", note: 'B3', duration: '8n' },
    { time: "20:2:2", note: 'B3', duration: '8n' },
    { time: "20:3", note: ['F#4', 'D4', 'B3'], duration: '8n' },
    { time: "20:3:2", note: 'F#4', duration: '8n' },
    { time: "21:0", note: ['E4', 'B3'], duration: '4n' },
    { time: '21:1', note: ['D4', 'B3'], duration: '4n' },
    { time: "21:2", note: 'B3', duration: '8n' },
    { time: "21:2:2", note: 'B3', duration: '8n' },
    { time: "21:3", note: ['F#4', 'D4', 'B3'], duration: '8n' },
    { time: "21:3:2", note: 'F#4', duration: '8n' },

    { time: "22:0", note: ['E4', 'A3', 'F#3'], duration: '4n' },
    { time: "22:1", note: ['D4', 'A3', 'F#3'], duration: '4n' },
    { time: "22:2", note: ['A3', 'F#3'], duration: '8n' },
    { time: "22:2:2", note: 'A3', duration: '8n' },
    { time: "22:3", note: ['A3', 'F#4', 'D4'], duration: '8n' },
    { time: "22:3:2", note: 'F#4', duration: '8n' },

    { time: "23:0", note: ['E3', 'C#4', 'A3'], duration: '4n' },
    { time: "23:1", note: ['D4', 'A3'], duration: '4n' },
    { time: "23:2:1", note: 'D4', duration: '16n' },
    { time: "23:2:2", note: 'F#4', duration: '8n' },
    { time: "23:3:0", note: ['A4', "E4", "C#4"], duration: '16n' },
    { time: "23:3:1", note: 'F#4', duration: '16n' },
    { time: "23:3:2", note: 'F#4', duration: '8n' },

    { time: "24:0", note: 'E4', duration: '4n' },
    { time: "24:2:1", note: 'D4', duration: '16n' },
    { time: "24:2:2", note: 'F#4', duration: '8n' },
    { time: "24:3:0", note: 'A4', duration: '16n' },
    { time: "24:3:1", note: 'F#4', duration: '16n' },
    { time: "24:3:2", note: 'E4', duration: '8n' },

    { time: "25:0", note: 'E4', duration: '4n' },
    { time: "25:2:1", note: 'D4', duration: '16n' },
    { time: "25:2:2", note: 'F#4', duration: '8n' },
    { time: "25:3:0", note: 'A4', duration: '16n' },
    { time: "25:3:1", note: 'F#4', duration: '16n' },
    { time: "25:3:2", note: 'E4', duration: '8n' },

    { time: "26:0", note: 'E4', duration: '16n' },
    { time: "26:0:1", note: 'F#4', duration: '16n' },
    { time: "26:0:2", note: 'E4', duration: '16n' },
    { time: "26:0:3", note: 'D4', duration: '16n' },
    { time: "26:1:0", note: 'B3', duration: '16n' },
];
snaresMusical = [
    { time: "0:0", note: ['B3', 'G3', "G2"], duration: '1m' + '2n' },
    { time: "1:3", note: ['F2', 'G2', "G3"], duration: '4n' },
    { time: "2:0", note: ['F#3', "D3", 'B2'], duration: '1m + 2n + 4n' },
    { time: "4:0", note: ['B3', 'G3', "G2"], duration: '1m' + '2n' },
    { time: "5:3", note: ['F2', 'G2', "G3"], duration: '4n' },
    { time: "6:0", note: ['F#3', "D3", 'B2'], duration: '1m + 2n' },
    { time: "8:0", note: 'G2', duration: '2m' },
    { time: "10:0", note: 'G2', duration: '2m' },
    { time: "12:0", note: 'G2', duration: '1m + 2n' },
    // { time: "1:3", note: [], duration: '2n' },
]

const cols = 4; //Needs to split it up that much. 
const colwth = 700 / cols;

const rows = 5;
const rowwth = 500 / rows;

let curPos = 0;

let pick1, pick2;

let game = { maxTime: 60, elapsedTime: 0, gameMode: "Start" };
let wonCardArray = []; //We will know the game is over when there has been 10 added to this array. 
//GameMode = {"Start" | "Game" |"End"}

let oneThirty = false; //This is so it will only change once when we hit 30 seconds.

// let myNote = [
//     ['E3', null, 'F#3', null], ['G3', null, 'A3', null], ['B3', null, 'G3', null], ['B3', null], ['Bb3', null, 'Gb3', null], ["Bb3", null], ['A3', null, 'F3', null], ['A3', null],
//     ['E3', null, 'F#3', null], ['G3', null, 'A3', null], ['B3', null, 'E4', null], ['D4', null, 'B3', null], ['G3', null, 'B3', null], 'D4',
//     ['E3', null, 'F#3', null], ['G3', null, 'A3', null], ['B3', null, 'G3', null], ['B3', null], ['Bb3', null, 'Gb3', null], ["Bb3", null], ['A3', null, 'F3', null], ['A3', null],
//     ['E3', null, 'F#3', null], ['G3', null, 'A3', null], ['B3', null, 'G3', null], ['B3', null, 'E4', null],
//     ['D#4', null, 'B3', null], ['D#4', null, 'F#4', null], 'E4'];

let myNote = [[null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], null, [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null, null]];
let instrument = new Tone.FMSynth().toDestination();

instrument.set({
    "harmonicity": 3.01, "modulationIndex": 14, "oscillator": { "type": "triangle" }, "envelope": { "attack": 0.2, "decay": 0.3, "sustain": 0.1, "release": 1.2 }, "modulation": { "type": "square" }, "modulationEnvelope": { "attack": 0.01, "decay": 0.5, "sustain": 0.2, "release": 0.1 }
});
instrument.volume.value = -6;

let freeverb = new Tone.Freeverb();
freeverb.set({ "roomSize": 0.9, "dampening": 2000, "wet": 0.5 });
instrument.connect(freeverb);
freeverb.connect(Tone.Master);

let duoSynth = new Tone.DuoSynth();
duoSynth.set({ "vibratoAmount": 0.5, "vibratoRate": 5, "harmonicity": 1.5, "voice0": { "volume": -6, "portamento": 0, "oscillator": { "type": "sine" }, "filterEnvelope": { "attack": 0.01, "decay": 0, "sustain": 1, "release": 0.5 }, "envelope": { "attack": 0.01, "decay": 0, "sustain": 1, "release": 0.5 } }, "voice1": { "volume": -20, "portamento": 0, "oscillator": { "type": "sine" }, "filterEnvelope": { "attack": 0.01, "decay": 0, "sustain": 1, "release": 0.5 }, "envelope": { "attack": 0.01, "decay": 0, "sustain": 1, "release": 0.5 } } });

let smallerFreverb = new Tone.Freeverb();
smallerFreverb.set({ "roomSize": 0.2, "dampening": 4300, "wet": 0.4 });
duoSynth.connect(smallerFreverb);
smallerFreverb.connect(Tone.Master);
// duoSynth.toDestination();//Delete if using previous.

let falseSynth = new Tone.PolySynth(Tone.MonoSynth);

falseSynth.set({ "oscillator": { "type": "square" }, "filter": { "Q": 2, "type": "lowpass", "rolloff": -12 }, "envelope": { "attack": 0.005, "decay": 3, "sustain": 0, "release": 0.45 }, "filterEnvelope": { "attack": 0.001, "decay": 0.32, "sustain": 0.9, "release": 3, "baseFrequency": 700, "octaves": 2.3 } });
let snare = new Tone.PolySynth(Tone.MetalSynth);
snare.connect(smallerFreverb); 
snare.volume.value = '-20';

falseSynth.toDestination();
snare.toDestination();


let pattern;

part = new Tone.Part(((time, note) => {
    falseSynth.triggerAttackRelease(note.note, note.duration, time);
    console.log(note);
}), musical);

part2 = new Tone.Part(((time, note) => {
    snare.triggerAttackRelease(note.note, note.duration, time);
    console.log(note);
}), snaresMusical);

function setup() {
    canv = createCanvas(800, 600).parent("sketchHolder");
    i = 0;
    console.log(myNote);
    pattern = new Tone.Sequence((time, note) => {
        instrument.triggerAttackRelease(note, "2n", time);
        duoSynth.triggerAttackRelease(note, "2n", time);
        console.log("Played " + note);
    }, myNote);

    Tone.Transport.bpm.value = 40;

    selections = [
        { color: "#b1f4a3", noteGroup: 0 },
        { color: "#efc88c", noteGroup: 1 },
        { color: "#824983", noteGroup: 2 },
        { color: "#bf3543", noteGroup: 3 },
        { color: "#83d9ff", noteGroup: 4 },
        { color: "orange", noteGroup: 5 },
        { color: "#ec84ae", noteGroup: 6 },
        { color: "#b7b7b7", noteGroup: 7 },
        { color: "#9e4b2d", noteGroup: 8 },
        { color: "#375a97", noteGroup: 9 },
    ];
    deck = [];

    startMenuArray = [new MenuButton({ text: "Start", x: 400, y: 450, purpose: function () { console.log("Start Clicked!"); clicked("Game"); } })];
    startMenuArray[0].picked = true;
    endMenuArray = [
        new MenuButton({ text: "Play Again", x: 300, y: 450, purpose: function () { part.stop(); part2.stop(); console.log("Play Again Clicked!"); clicked("Game"); } }),
        new MenuButton({ text: "Main Menu", x: 500, y: 450, purpose: function () { part.stop(); part2.stop(); console.log("Main Menu Clicked!"); clicked("Start"); } })
    ];
    endMenuArray[0].picked = true;
}


function draw() {
    switch (game.gameMode) {
        case "Game":
            background("white");
            for (i = 0; i < deck.length; i++) {
                deck[i].draw();
            }


            let currentTime = ceil(game.maxTime - game.elapsedTime);
            console.log("currentTime: " + currentTime + " BPM: " + ceil(Tone.Transport.bpm.value));
            game.elapsedTime += deltaTime / 1000;

            push();
            fill("black");
            textSize(32);
            text("Time: " + currentTime, 50, 50);
            pop();


            if (currentTime < 0) {
                // console.log("Its Over"); 
                clicked("Lost");
            }
            break;
        case "Start":
            push();
            background("#FFB3CD");
            textFont('Helvetica');
            textAlign(CENTER);
            fill("white");
            textSize(100);
            text('Matching Game', 0, 150, 800, 120);
            textSize(32);
            text("Use the joystick to match the cards to reveal the lost notes! Can you restore the lost music in time?", 0, 300, 800, 180);
            pop();
            startMenuArray[0].draw();
            // console.log(startMenuArray); 
            // startMenuArray[0].purpose(); 
            break;

        case "Win":
            push();
            background("teal");
            textAlign(CENTER);
            textSize(80);
            fill("white");
            text("You Win!!", 400, 200);
            textSize(32);
            text("Now You Get To Hear A New Song!", 400, 300);
            endMenuArray[0].draw();
            endMenuArray[1].draw();
            pop();
            break;
        case "Lost":
            push();
            background("red");
            textAlign(CENTER);
            textSize(80);
            fill("white");
            text("You LOST!!", 400, 200);
            textSize(32);
            text("No New Song For LOSERS!", 400, 300);
            endMenuArray[0].draw();
            endMenuArray[1].draw();
            pop();
            break;
        default:
            // background("purple");
            text("Default", 400, 300);
            break;
    }


}

//This function resets the board!
function clicked(mode) {
    Tone.Transport.start();
    if (mode !== undefined) {
        game.gameMode = mode;
    }
    // console.log("Mode: " + mode);
    myNote = [[null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], null, [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null, null, null], [null, null], [null, null, null, null], [null, null, null]];

    if (game.gameMode === "Game") {
        pattern.stop();
        pattern = new Tone.Sequence((time, note) => {
            instrument.triggerAttackRelease(note, "2n", time);
            duoSynth.triggerAttackRelease(note, "2n", time);
            console.log("Played " + note);
        }, myNote);

        console.log("Clicked.");
        pattern.start();
    }
    game.elapsedTime = 0;


    setDeck();
    deck = shuffle(deck);
    setPos();
    curPos = 0;
    deck[curPos].hover = true;
    pick1 = -1;
    pick2 = -1;
    wonCardArray = []; //Empties this array.

}

function setDeck() {
    deck = [];
    for (i = 0; i < cols * rows / 2; i++) {
        deck.push(new Card(selections[i]));
        deck.push(new Card(selections[i]));
    }
}

function setPos() {
    //well We should set it up that way. So 
    let c = 0;
    let r = 0;
    for (i = 0; i < deck.length; i++) {
        deck[i].x = 60 + (colwth * c);
        deck[i].y = 60 + (rowwth * r);
        r = (r + 1) % rows;
        if (r === 0) {
            c++;
        }
    }
}


function keyPressed() {
    switch (game.gameMode) {
        case "Game":
            switch (keyCode) {
                case RIGHT_ARROW:
                    // console.log("→");
                    deck[curPos].hover = false;
                    curPos = (curPos + cols + 1) % deck.length;
                    break;
                case LEFT_ARROW:
                    // console.log("←");
                    deck[curPos].hover = false;
                    if (curPos <= cols) {
                    } else {
                        curPos = (curPos - cols - 1) % deck.length;
                    }
                    break;
                case DOWN_ARROW:
                    // console.log("↓");
                    deck[curPos].hover = false;
                    curPos = (curPos + 1) % deck.length;
                    break;
                case UP_ARROW:
                    // console.log("↑");
                    deck[curPos].hover = false;
                    if (curPos === 0) {
                        curPos = deck.length - 1;
                    } else {
                        curPos--;
                    }
                    break;
                case 32:
                    if (pick1 !== -1 && pick2 === -1) {
                        pick2 = curPos;
                        deck[pick2].picked = true;

                        //This checks to see if they are a match or not!
                        if (deck[pick1].color === deck[pick2].color && pick1 !== pick2) {
                            console.log("We found a match" + deck[pick1].noteGroup);
                            deck[pick1].matched = true;
                            deck[pick2].matched = true;
                            wonCardArray.push(deck[pick1].color);
                            console.log("Matches: " + wonCardArray.length);

                            noteGroupOn(deck[pick1].noteGroup);
                            pick1 = -1;
                            pick2 = -1;
                            if (wonCardArray.length === 10) {
                                // clicked("Win");
                                setTimeout(() => {
                                    winClicked();
                                }, 1000);
                            }
                        } else {
                            let prev1 = pick1;
                            let prev2 = pick2;
                            console.log("picked1: " + pick1 + "\npicked2: " + pick2);
                            pick1 = -1;
                            pick2 = -1;
                            setTimeout(() => {
                                deck[prev2].picked = false;
                                deck[prev1].picked = false;
                            }, 1000);
                        }
                    } else if (pick1 === -1) {
                        pick1 = curPos;
                        deck[curPos].picked = true;
                    }
                    break;
                default:
                    break;
            }
            deck[curPos].hover = true;
            break;
        case "Start":
            switch (keyCode) {
                case 32:
                    console.log("Space");
                    startMenuArray[0].selected();
                    break;
                default:
                    break;
            }
            break;
        case "Win":
            switch (keyCode) {
                case 32:
                    if (endMenuArray[0].picked) {
                        endMenuArray[0].selected();
                    } else if (endMenuArray[1].picked) {
                        endMenuArray[1].selected();
                    }
                    break;
                case LEFT_ARROW:
                    endMenuArray[0].picked = true;
                    endMenuArray[1].picked = false;
                    break;
                case RIGHT_ARROW:
                    endMenuArray[1].picked = true;
                    endMenuArray[0].picked = false;
                    break;
                default:
                    break;
            }
            break;
        case "Lost":
            switch (keyCode) {
                case 32:
                    if (endMenuArray[0].picked) {
                        endMenuArray[0].selected();
                    } else if (endMenuArray[1].picked) {
                        endMenuArray[1].selected();
                    }
                    break;
                case LEFT_ARROW:
                    endMenuArray[0].picked = true;
                    endMenuArray[1].picked = false;
                    break;
                case RIGHT_ARROW:
                    endMenuArray[1].picked = true;
                    endMenuArray[0].picked = false;
                    break;
                default:
                    break;
            }
            break;
    }
}

function addNotes(array) {
    pattern.stop();
    for (let i = 0; i < array[1].length; i++) {
        myNote[array[1][i][0]][array[1][i][1]] = array[0];
    }

    pattern = new Tone.Sequence((time, note) => {
        instrument.triggerAttackRelease(note, "2n", time);
        duoSynth.triggerAttackRelease(note, '2n', time);
        console.log("Played " + note);
    }, myNote);

    pattern.start();
    console.log(myNote);

}

function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
}


function noteGroupOn(noteGroupNum) {
    switch (noteGroupNum) {
        case 1:
            console.log(1);
            addNotes(['E3', [[0, 0], [8, 0], [15, 0], [23, 0]]]);
            break;
        case 2:
            console.log(2);
            addNotes(['B3', [[2, 0], [3, 0], [10, 0], [11, 0], [12, 2], [13, 2], [17, 0], [18, 0], [25, 0], [26, 0], [27, 2]]]);
            break;
        case 3:
            console.log(3);
            addNotes(['Gb3', [[4, 2], [19, 2]]]);
            addNotes(['F#4', [[28, 2]]])
            break;
        case 4:
            console.log(4);
            myNote[29] = 'E4';
            addNotes(['E4', [[11, 2], [26, 2]]]);
            break;
        case 5:
            console.log(5);
            myNote[14] = 'D4';
            addNotes(['D#4', [[27, 0], [28, 0]]]);
            addNotes(['D4', [[12, 0]]]);
            break;
        case 6:
            console.log(6);
            addNotes(['G3', [[1, 0], [2, 2], [9, 0], [10, 2], [13, 0], [16, 0], [17, 2], [24, 0], [25, 2]]]);
            break;
        case 7:
            console.log(7);
            addNotes(['F3', [[6, 2], [21, 2]]]);
            break;
        case 8:
            console.log(8);
            addNotes(['Bb3', [[4, 0], [5, 0], [19, 0], [20, 0]]]);
            break;
        case 9:
            console.log(9);
            addNotes(['A3', [[1, 2], [6, 0], [7, 0], [9, 2], [16, 2], [21, 0], [22, 0], [24, 2]]]);
            break;
        case 0:
            console.log(0);
            addNotes(['F#3', [[0, 2], [8, 2], [15, 2], [23, 2]]]);
            break;
        default:
            break;
    }
}

function winClicked() {
    pattern.stop();
    Tone.Transport.stop();
    console.log("win Clicked");
    game.gameMode = "Win";
    freeverb.roomSize.value = 0.2; 
    smallerFreverb.roomSize.rampTo(0.7, 10);

    part = new Tone.Part(((time, note) => {
        falseSynth.triggerAttackRelease(note.note, note.duration, time);
        console.log(note);
    }), musical);

    part2 = new Tone.Part(((time, note) => {
        snare.triggerAttackRelease(note.note, note.duration, time);
        console.log(note);
    }), snaresMusical);
    Tone.Transport.start();
    Tone.Transport.bpm.value = 80;
    part.start();
    part2.start();
}

function connect(){
    console.log("Connect!");
}


class Card {
    constructor(struct) {
        this.x = 0;
        this.y = 0;
        this.color = struct.color;
        this.noteGroup = struct.noteGroup;
        this.hover = false;
        this.picked = false;
        this.matched = false;
    }

    draw() {
        noStroke();
        if (this.picked || this.matched) {
            fill(this.color);
        } else {
            fill("black");
        }
        rect(this.x, this.y, colwth - 20, rowwth - 20);
        if (this.hover) {
            fill("white");
            circle(this.x + (colwth - 20) / 2, this.y + (rowwth - 20) / 2, 50);
        }
    }
}

class MenuButton {
    constructor(struct) {
        this.text = struct.text;
        this.x = struct.x;
        this.y = struct.y;
        this.picked = false;
        this.purpose = struct.purpose;
    }

    purpose() {
        console.log("Undefined Purpose :(");
    }

    selected() {
        if (this.picked) {
            this.purpose();
        }
    }

    draw() {
        push();
        textSize(32);
        textAlign(CENTER, CENTER);
        // rectMode(CENTER);
        noStroke();
        fill("white");
        rect(this.x - 60, this.y - 40, 120, 80);
        fill("black");
        text(this.text, this.x - 60, this.y - 40, 120, 80);
        if (this.picked) {
            fill("rgba(139,195,74,0.5)");
            rect(this.x - 60, this.y - 40, 120, 80);
        }
        pop();
    }
}

